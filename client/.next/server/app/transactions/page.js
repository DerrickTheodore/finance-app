(()=>{var e={};e.id=790,e.ids=[790],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},937:(e,t,n)=>{Promise.resolve().then(n.bind(n,4470))},1889:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>E});var a=n(9513),r=n(8796),s=n.n(r),i=n(2306),o=n.n(i);function c(){return(0,a.jsx)("div",{className:o().page,children:(0,a.jsxs)("main",{className:o().main,children:[(0,a.jsx)("h1",{children:"Transactions"}),(0,a.jsx)("div",{className:o().skeleton,style:{height:"80px"}}),(0,a.jsx)("div",{className:o().skeleton,style:{height:"300px"}}),(0,a.jsx)("div",{className:o().skeleton,style:{height:"300px"}})]})})}var l=n(6788),d=n(3354);let u=({startDate:e,endDate:t,onStartDateChange:n,onEndDateChange:r,onFetch:s,isFetching:i,isFetchDisabled:c})=>(0,a.jsxs)("section",{className:o().section,children:[(0,a.jsx)("h4",{children:"Select Date Range:"}),(0,a.jsxs)("div",{className:o().dateRangeContainer,children:[(0,a.jsxs)("div",{className:o().dateInputGroup,children:[(0,a.jsx)("label",{htmlFor:"startDate",children:"Start Date: "}),(0,a.jsx)("input",{type:"date",id:"startDate",value:e,onChange:e=>n(e.target.value),className:o().dateInput})]}),(0,a.jsxs)("div",{className:o().dateInputGroup,children:[(0,a.jsx)("label",{htmlFor:"endDate",children:"End Date: "}),(0,a.jsx)("input",{type:"date",id:"endDate",value:t,onChange:e=>r(e.target.value),className:o().dateInput})]})]}),(0,a.jsx)("button",{onClick:s,disabled:i||c,className:o().button,children:i?"Fetching Transactions...":"Get Transactions"})]});var p=n(8548),h=n.n(p),g=n(1934);let x=({transaction:e,allCategories:t,onLinkCategory:n,onUnlinkCategory:r})=>{let[i,o]=s().useState("");return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.date}),(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{children:e.merchantName}),(0,a.jsx)("td",{style:{textAlign:"right"},children:new Intl.NumberFormat("en-US",{style:"currency",currency:e.isoCurrencyCode||"USD"}).format(parseFloat(e.amount))}),(0,a.jsx)("td",{children:e.categories?.map(t=>(0,a.jsxs)("span",{style:{backgroundColor:t.color||"#eee",color:t.color?"white":"black",padding:"2px 6px",borderRadius:"4px",marginRight:"4px",fontSize:"0.9em"},children:[t.name,(0,a.jsx)("button",{onClick:()=>r(e.id,t.id),style:{marginLeft:"4px",border:"none",background:"transparent",color:"inherit",cursor:"pointer"},children:"\xd7"})]},t.id))}),(0,a.jsxs)("td",{children:[(0,a.jsxs)("select",{value:i,onChange:e=>o(e.target.value),style:{marginRight:"5px",padding:"5px"},children:[(0,a.jsx)("option",{value:"",children:"Assign Category"}),t.filter(t=>!e.categories?.find(e=>e.id===t.id)).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("button",{onClick:()=>{i&&(n(e.id,parseInt(i,10)),o(""))},disabled:!i,style:{padding:"5px 10px"},children:"Assign"})]})]},e.id)},m=({transactions:e,categories:t,isFetchingCategories:n,assignMutation:r,unlinkMutation:s,queryAttempted:i=!0,missingParams:c=!1})=>c?(0,a.jsx)(g.A,{message:"No account or date range selected. Please select an account and date range, or go to the Accounts page.",action:(0,a.jsx)(h(),{href:"/accounts",className:o().linkToAccounts,children:"Accounts"}),className:o().section}):0===e.length&&i?(0,a.jsx)(g.A,{message:"No transactions found for the selected parameters.",className:o().section}):(0,a.jsxs)("section",{className:o().section,children:[(0,a.jsx)("h3",{children:"Transactions:"}),n&&(0,a.jsx)("p",{children:"Loading categories..."}),(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Date"}),(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Merchant"}),(0,a.jsx)("th",{style:{textAlign:"right"},children:"Amount"}),(0,a.jsx)("th",{children:"Categories"}),(0,a.jsx)("th",{children:"Assign"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsx)(x,{transaction:e,allCategories:t,onLinkCategory:(e,t)=>r.mutate({transactionId:e,categoryId:t}),onUnlinkCategory:(e,t)=>s.mutate({transactionId:e,categoryId:t})},e.id))})]})]});var f=n(9037),j=n(2020),y=n(5373),v=n(5792);async function k(e,t){let n=`${(0,j.h)()}/api/transactions/${e}/categories`,a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoryId:t})});if(!a.ok){if(401===a.status)return null;throw Error(await a.text()||"Failed to assign category")}return a.json()}async function b(e,t){let n=`${(0,j.h)()}/api/transactions/${e}/categories-unlink/${t}`,a=await fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)return{message:"Unauthorized (build)"};throw Error(await a.text()||"Failed to unlink category")}return a.json()}var w=n(5208);function _({transactions:e,categories:t,isFetchingTransactions:n,isFetchingCategories:r,assignMutation:s,unlinkMutation:i,transactionFetchError:c,startDate:l,endDate:d,onStartDateChange:p,onEndDateChange:h,onFetch:g,missingParams:x,queryAttempted:f}){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{startDate:l,endDate:d,onStartDateChange:p,onEndDateChange:h,onFetch:g,isFetching:n,isFetchDisabled:x||n}),c&&(0,a.jsx)("section",{className:o().section,children:(0,a.jsxs)("p",{style:{color:"red"},children:["Error fetching transactions: ",c.message]})}),(0,a.jsx)(m,{transactions:e,categories:t,isFetchingCategories:r,assignMutation:s,unlinkMutation:i,queryAttempted:f,missingParams:x})]})}function C(e){let{selectedItem:t,selectedAccountIds:n,startDate:r,endDate:s,assignMutation:i,unlinkMutation:o,categories:c,isFetchingCategories:l,onStartDateChange:d,onEndDateChange:u}=e,p=!t||0===n.length,{data:h=[],isFetching:g,error:x,refetch:m}=(0,w.x)({plaidItemId:t?.plaidItemId||"",accountIds:n,startDate:r,endDate:s});return(0,a.jsx)(_,{transactions:h,categories:c,isFetchingTransactions:g,isFetchingCategories:l,assignMutation:i,unlinkMutation:o,transactionFetchError:x||null,startDate:r,endDate:s,onStartDateChange:d,onEndDateChange:u,onFetch:m,missingParams:p,queryAttempted:!p})}function D(){let{selectedItem:e,selectedAccountIds:t}=(0,d.A)(),{user:n}=(0,l.A)(),{assignMutation:s,unlinkMutation:i}=function(e=!0){let t=(0,y.jE)();return{assignMutation:(0,v.n)({mutationFn:({transactionId:e,categoryId:t})=>k(e,t),onSuccess:(e,{selectElement:n})=>{t.invalidateQueries({queryKey:[["transactions"]]}),n&&(n.value="")}}),unlinkMutation:(0,v.n)({mutationFn:({transactionId:e,categoryId:t})=>b(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:[["transactions"]]})}})}}(!!n),[c,u]=(0,r.useState)(()=>{let e=new Date;return e.setDate(e.getDate()-30),e.toISOString().split("T")[0]}),[p,h]=(0,r.useState)(()=>new Date().toISOString().split("T")[0]),g=n?(0,f.Ck)():{data:[],isFetching:!1},x=g.data||[],m=g.isFetching;return n?(0,a.jsx)("div",{className:o().page,children:(0,a.jsxs)("main",{className:o().main,children:[(0,a.jsx)("h1",{children:"Transactions"}),(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading transactions..."}),children:(0,a.jsx)(C,{selectedItem:e,selectedAccountIds:t,startDate:c,endDate:p,onStartDateChange:u,onEndDateChange:h,assignMutation:s,unlinkMutation:i,categories:x,isFetchingCategories:m})})]})}):null}function E(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(c,{}),children:(0,a.jsx)(D,{})})}},1934:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var a=n(9513);n(8796);let r=({message:e,action:t,className:n})=>(0,a.jsxs)("div",{className:n,style:{textAlign:"center",color:"#888",padding:"2rem 1rem",fontSize:"1.1rem"},children:[(0,a.jsx)("div",{style:{fontSize:"2.5rem",marginBottom:"0.5rem"},children:"\uD83E\uDEB9"}),(0,a.jsx)("div",{children:e}),t&&(0,a.jsx)("div",{style:{marginTop:"1rem"},children:t})]})},2306:e=>{e.exports={page:"page_page__ZU32B",main:"page_main__GlU4n",ctas:"page_ctas__g5wGe",primary:"page_primary__V8M9Y",secondary:"page_secondary__lm_PT",footer:"page_footer__sHKi3",logo:"page_logo__7fc9l",skeleton:"page_skeleton___FdI7","skeleton-loading":"page_skeleton-loading__dMUvC",linkToAccounts:"page_linkToAccounts__YthRO"}},2793:(e,t,n)=>{Promise.resolve().then(n.bind(n,1889))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4470:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});let a=(0,n(7629).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/derricktheodore/app-library/finance-app/client/src/app/transactions/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/derricktheodore/app-library/finance-app/client/src/app/transactions/page.tsx","default")},5208:(e,t,n)=>{"use strict";n.d(t,{x:()=>i});var a=n(2020),r=n(7302);async function s(e){if(!e.plaidItemId||0===e.accountIds.length)return[];let t=new URLSearchParams({plaidItemId:e.plaidItemId,startDate:e.startDate,endDate:e.endDate});e.accountIds.forEach(e=>t.append("account_ids[]",e));let n=`${(0,a.h)()}/api/plaid/transactions?${t.toString()}`,r=await fetch(n);if(!r.ok){if(401===r.status)return[];throw Error(await r.text()||"Failed to fetch transactions")}return await r.json()}function i(e){let{plaidItemId:t,accountIds:n,startDate:a,endDate:i}=e;return(0,r.U)({queryKey:["transactions",t,n,a,i],queryFn:()=>s({plaidItemId:t,accountIds:n,startDate:a,endDate:i})})}},7302:(e,t,n)=>{"use strict";n.d(t,{U:()=>i});var a=n(6416),r=n(4951),s=n(8751);function i(e,t){return(0,r.t)({...e,enabled:!0,suspense:!0,throwOnError:s.R3,placeholderData:void 0},a.$,t)}},7308:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l});var a=n(6845),r=n(5130),s=n(7412),i=n.n(s),o=n(1955),c={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);n.d(t,c);let l={children:["",{children:["transactions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,4470)),"/Users/derricktheodore/app-library/finance-app/client/src/app/transactions/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(n.bind(n,8361))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(n.bind(n,3631)),"/Users/derricktheodore/app-library/finance-app/client/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,8720,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(n.t.bind(n,8665,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(n.t.bind(n,790,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(n.bind(n,8361))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/Users/derricktheodore/app-library/finance-app/client/src/app/transactions/page.tsx"],u={require:n,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/transactions/page",pathname:"/transactions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},8361:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(8256);let r=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},9037:(e,t,n)=>{"use strict";n.d(t,{Ck:()=>u,GK:()=>p,bZ:()=>h,xZ:()=>g});var a=n(2020),r=n(7302),s=n(5373),i=n(5792);async function o(){let e=`${(0,a.h)()}/api/categories`,t=await fetch(e);if(!t.ok)throw Error(await t.text()||"Network response was not ok");return t.json()}async function c(e){let t=`${(0,a.h)()}/api/categories`,n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw Error(await n.text()||"Network response was not ok");return n.json()}async function l({categoryId:e,categoryData:t}){let n=`${(0,a.h)()}/api/categories/${e}`,r=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error(await r.text()||"Network response was not ok");return r.json()}async function d(e){let t=`${(0,a.h)()}/api/categories/${e}`,n=await fetch(t,{method:"DELETE"});if(!n.ok)throw Error(await n.text()||"Network response was not ok");return n.json()}function u(){return(0,r.U)({queryKey:["categories"],queryFn:o})}function p(){let e=(0,s.jE)();return(0,i.n)({mutationFn:c,onSuccess:()=>{e.invalidateQueries({queryKey:["categories"]})}})}function h(){let e=(0,s.jE)();return(0,i.n)({mutationFn:l,onSuccess:()=>{e.invalidateQueries({queryKey:["categories"]})}})}function g(){let e=(0,s.jE)();return(0,i.n)({mutationFn:d,onSuccess:()=>{e.invalidateQueries({queryKey:["categories"]})}})}},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[345,804,256,113],()=>n(7308));module.exports=a})();